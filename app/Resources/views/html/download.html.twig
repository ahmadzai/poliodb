{% extends 'main_filter.html.twig' %}
{% block content %}
<div class="container">
    <!-- Breadcrumbs line -->
    <div class="crumbs" role="">
        <ul id="breadcrumbs" class="breadcrumb">
            <li>
                <i class="icon-home"></i>
                <a href="{{ path('home_admin_data') }}">Dashboard</a>
            </li>
            {#<li class="current">#}
                {#<a href="pages_calendar.html" title="">Calendar</a>#}
            {#</li>#}
        </ul>
        </div>

        <div class="page-header">
            <div class="page-title">
                <span>Hello, {{app.user.username|capitalize}}!</span>
            </div>
        </div>

        <!-- <div>
            <h2>Posts</h2>
            {#  {{ sg_datatables_render(datatable) }}  #}

        </div> -->

        <table id="example" class="table table-striped table-bordered table-hover table-checkable datatable" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Region</th>
                <th>Province</th>
                <th>District</th>
                <th>S-District</th>
                <th>Cluster</th>
                <th>C-Type</th>
                <th>C-Month</th>
                <th>C-Year</th>
                <th>ReceivedVials</th>
                <th>UsedVials</th>
                <th>Child011</th>
                <th>Child1259</th>
                <th>RegAbsent</th>
                <th>VaccAbsent</th>
                <th>RegSleep</th>
                <th>VaccSleep</th>
                <th>RegRefusal</th>
                <th>VaccRefusal</th>
                <th>VaccDay</th>
                <th>Missed</th>

            </tr>
        </thead>
    </table>

        {% block script_end %}

            <script>

            function format ( d ) {
              // `d` is the original data object for the row
                    return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">'+
                        '<tr>'+
                            '<td>Full name:</td>'+
                            '<td>'+d.Cluster+'</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<td>Extension number:</td>'+
                            '<td>'+d.ClusterName+'</td>'+
                        '</tr>'+
                        '<tr>'+
                            '<td>Extra info:</td>'+
                            '<td>And any further details here (images etc)...</td>'+
                        '</tr>'+
                    '</table>';
            }


                $(document).ready(function () {
                    // $('.loading, .loading-top').hide();
                    testdata = [{"Region":"CR","Province":"Kabul","District":"Kabul","SDistrict":"1A","Cluster":"1A","CType":"1A","CMonth":"1A","CYear":"1A","SubDistrictName":"1B","ReceivedVials":"329","UsedVials":"307",
                    "VaccineWastage":"43", "Child011":"919","Child1259":"4433","RegAbsent":"519","VaccAbsent":"70","RegSleep":"3","VaccSleep":"33","RegRefusal":"65","VaccRefusal":"43",
                    "VaccDay":"1","Missed":"449", "TotalChildrenVaccinated":"1000"}];
                    //testdata = JSON.parse('{{lastcamp|raw}}');
                    //console.log(testdata);
                    var table = $('#example').DataTable( {
                        //  "processing": true,
                        dom: 'Blfrtip',
                        "searching": false,
                        buttons: [{
                                      extend: 'colvis',
                                      columns: ':not(.noVis)'
                                  },
                                  {
                                     extend: 'collection',
                                     text: 'Raw Data',
                                     buttons: [ {
                                              extend: 'excelHtml5',
                                              exportOptions: {
                                                  columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19 ]
                                              }
                                                },
                                                {
                                                   extend: 'csvHtml5',
                                                   exportOptions: {
                                                       columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19 ]
                                                   }
                                                 },
                                                 {
                                                        extend: 'pdfHtml5',
                                                        exportOptions: {
                                                            columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19 ]
                                                        }
                                                  } ]

                                  },
                                  {
                                     extend: 'collection',
                                     text: 'Aggregate Data',
                                     buttons: [ {
                                              extend: 'excelHtml5',
                                              exportOptions: {
                                                  columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19 ]
                                              }
                                                },
                                                {
                                                   extend: 'csvHtml5',
                                                   exportOptions: {
                                                       columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19 ]
                                                   }
                                                 },
                                                 {
                                                        extend: 'pdfHtml5',
                                                        exportOptions: {
                                                            columns: [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 19 ]
                                                        }
                                                } ]

                                  }

                        ],
                        destroy: true,
                        "pageLength": 20,
                        "type"   : "POST",
                        //  "serverSide": true,
                         "aaData": testdata,
                        //  columnDefs: [
                        //   {
                        //       targets: 1,
                        //       className: 'noVis'
                        //   }],
                        "columns": [
                          // {
                          //       targets: 1,
                          //       className: 'noVis'
                          // },
                          // {
                          //     "class":          "details-control",
                          //     "orderable":      false,
                          //     "data":           null,
                          //     "defaultContent": ""
                          // },<th>Cluster</th>
                            { "data": "Region"},
                            { "data": "Province" },
                            { "data": "District"},
                            { "data": "SDistrict", "visible": false},
                            { "data": "Cluster"},
                            { "data": "CType"},
                            { "data": "CMonth", "visible": false},
                            { "data": "CYear"},
                            { "data": "ReceivedVials", "visible": false},
                            { "data": "UsedVials", "visible": false},
                            { "data": "Child011", "visible": false},
                            { "data": "Child1259", "visible": false},
                            { "data": "RegAbsent", "visible": false},
                            { "data": "VaccAbsent", "visible": false},
                            { "data": "RegSleep", "visible": false},
                            { "data": "VaccSleep", "visible": false},
                            { "data": "RegRefusal", "visible": false},
                            { "data": "VaccRefusal", "visible": false},
                            { "data": "VaccDay", "visible": false},
                            { "data": "Missed", "visible": false},

                        ], "order": [[1, 'asc']]
                        } );

                    //ajaxRequest();
                    var detailRows = [];

                    $('#example tbody').on('click', 'td.details-control', function () {
                          var tr = $(this).closest('tr');
                          var row = table.row( tr );

                          if ( row.child.isShown() ) {
                              // This row is already open - close it
                              row.child.hide();
                              tr.removeClass('shown');
                          }
                          else {
                              // Open this row
                              row.child( format(row.data()) ).show();
                              tr.addClass('shown');
                          }
                      } );



                    $('#filterButton').click(function () {
                        var campaigns = $('#filterCampaign option:selected');
                        var selectedCampaigns = [];
                        $(campaigns).each(function (index, campaigns) {
                            selectedCampaigns.push([$(this).val()]);
                        });

                        var region = $('#filterRegion option:selected');
                        var selectedRegions = [];
                        $(region).each(function (index, region) {
                            selectedRegions.push([$(this).val()]);
                        });

                        var provinces = $('#filterProvince option:selected');
                        var selectedProvinces = [];
                        $(provinces).each(function (index, provinces) {
                            selectedProvinces.push([$(this).val()]);
                        });

                        var districts = $('#filterDistrict option:selected');
                        var selectedDistricts = [];
                        $(districts).each(function (index, districts) {
                            selectedDistricts.push([$(this).val()]);
                        });

                        var data = {'campaign':selectedCampaigns, 'region':selectedRegions, 'province': selectedProvinces, 'district': selectedDistricts};

                        //console.log(data);


                        $.ajax({
                            url: Routing.generate('ajax_download_data'),
                            data: data,
                            type: 'POST',
                            success: function (data) {
                                //console.log(data);
                                 var jsonData = JSON.parse(data);
                                // table.ajax.reload( function ( data ) {
                                // table.val( data.lastInput );
                                // } );
                                // if(table != null){
                                //   console.log("not if");
                              table.clear();
                              table.rows.add( jsonData ).draw();


                            },
                            cache: false
                        });

                    })
                });

                // function ajaxRequest() {
                //     //var test = "test";
                //     //var data = {'data': test};
                //     $.ajax({
                //         url: Routing.generate('ajax_download_data_all'),
                //         //data: data,
                //         type: 'POST',
                //         success: function (data) {
                //           //console.log(data);
                //         //    var jsonData = JSON.parse(data);
                //         //
                //         // table.clear();
                //         // table.rows.add( jsonData ).draw();
                //         }
                //     });
                // }

            </script>

        {% endblock %}


</div>
{% endblock %}
